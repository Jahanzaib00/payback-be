generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                        String   @id @default(uuid()) @db.Uuid
  email                     String   @unique
  passwordHash              String?  @map("password_hash")
  name                      String
  emailVerified             Boolean  @default(false) @map("email_verified")
  referralCode              String   @unique @map("referral_code")
  referredByUserId          String?  @map("referred_by_user_id") @db.Uuid
  pfCoinBalance             Decimal  @default(0) @map("pf_coin_balance") @db.Decimal(10, 2)
  subscriptionStatus        String   @default("inactive") @map("subscription_status")
  subscriptionId            String?  @map("subscription_id")
  stripeCustomerId          String?  @map("stripe_customer_id")
  stripeConnectAccountId    String?  @map("stripe_connect_account_id")
  createdAt                 DateTime @default(now()) @map("created_at")
  updatedAt                 DateTime @updatedAt @map("updated_at")

  // Self-referral relationship
  referredBy                User?    @relation("UserReferral", fields: [referredByUserId], references: [id])
  referrals           User[]   @relation("UserReferral")

  @@map("users")
}

model Referral {
  id                        String   @id @default(uuid()) @db.Uuid
  referrerUserId            String   @map("referrer_user_id") @db.Uuid
  referredUserId            String   @map("referred_user_id") @db.Uuid
  rewardAmount              Decimal  @default(0) @map("reward_amount") @db.Decimal(10, 2)
  rewardPaidAt              DateTime? @map("reward_paid_at")
  createdAt                 DateTime @default(now()) @map("created_at")

  @@unique([referrerUserId, referredUserId])
  @@map("referrals")
}
